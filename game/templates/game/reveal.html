{% extends 'layout.html' %} {% block main %}
<h1>Deal or No Deal - Reveal Cases</h1>

{% if revealed %}
<h2>Revealed Cases:</h2>
<ul>
  {% for case in revealed %}
  <li>Case {{ case.0 }}: {{ case.1 }}</li>
  {% endfor %}
</ul>
<p>
  <a href="{{ url_for('game_bp.get_offer') }}" class="btn btn-primary"
    >Get Offer</a
  >
</p>
{% else %}
<form id="revealForm" method="post">
  <div class="row row-cols-3">
    {% for case in cases %}
    <div class="col">
      <label>
        <input
          type="checkbox"
          name="case_nums"
          value="{{ case.num }}"
          class="case-checkbox"
          {%
          if
          case.disabled
          %}disabled{%
          endif
          %}
        />
        <div
          class="maletin {% if case.selected %}selected{% elif case.disabled %}disabled{% else %}available{% endif %}"
        >
          <i class="fa-solid fa-suitcase"></i>
          <span class="numero">{{ case.num }}</span>
        </div>
      </label>
    </div>
    {% endfor %}
  </div>
  <p>Select exactly {{ num_to_reveal }} cases to reveal.</p>
  <input
    id="revealButton"
    type="submit"
    value="Reveal Cases"
    class="btn btn-primary mt-3"
    disabled
  />
</form>
{% endif %}

<form action="{{ url_for('game_bp.reset_game') }}" method="post">
  <input type="submit" value="Reset Game" class="btn btn-danger mt-3" />
</form>

<style>
  input[type="checkbox"] {
    display: none;
  }

  .maletin {
    position: relative;
    display: inline-block;
    font-size: 48px;
    text-align: center;
    cursor: pointer;
    padding: 10px;
  }

  .maletin .numero {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 0.5em;
    color: #1e293b;
    font-weight: bold;
  }

  .maletin.selected {
    color: #facc15;
  }

  .maletin.disabled {
    color: #2563eb;
    cursor: not-allowed;
  }

  .maletin.available {
    color: #16a34a;
  }

  input[type="checkbox"]:checked + .maletin {
    color: #991b1b;
  }
</style>

{% block script %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.getElementById("revealForm");
    const checkboxes = form.querySelectorAll(".case-checkbox");
    const revealButton = document.getElementById("revealButton");
    const numToReveal = {{ num_to_reveal }};

    checkboxes.forEach(function (checkbox) {
      checkbox.addEventListener("change", function () {
        const selectedCheckboxes = form.querySelectorAll(".case-checkbox:checked");
        revealButton.disabled = selectedCheckboxes.length !== numToReveal;
      });
    });
  });
</script>
{% endblock %} {% endblock %}
